<?php

namespace App\Http\Controllers;
use App\Models\Exploit;
use Illuminate\Http\Request;

class ExploitController extends Controller
{
    // show card main page 
    public function index(){
        $username=session('admin_username');
        if($username!=null)
        {
            return view('admin.exploit.add-exploit');
        }
        else
        {
            return view('admin.loginPanel');
        }
        
    }

    // add card 
    public function exploit_account_store( Request $request){
        // feiled validation 
        $this ->validate( $request, [
            'exploit_name' => 'required',
            'platform' => 'required',
            'script' => 'required|file|mimes:zip',
            'price' => 'required'
         ]);
         /**
         * File collect from form 
         */
        if( $request-> hasFile( 'script')) {
            $scripts = $request -> file( 'script');
            $scripts_name = md5(time().rand()).'.'.$scripts ->getClientOriginalExtension() ;
            $scripts -> move(  public_path('scripts/'), $scripts_name) ;
        } else {
            $scripts_name = "" ;
        }

        Exploit::create([
             'exploit_name' => $request -> exploit_name,
             'platform' => $request -> platform,
             'script' => $scripts_name,
             'price' => $request -> price
         ]);   
 
      // Added successfully masagge
      return redirect ()-> back() -> with('success', 'Data Added Successful'); 
    }

    /**
     * show all card page
     */
    public function showall_exploit_list(){
        $username=session('admin_username');
        if($username!=null)
        {
            $all_exploit = Exploit::all();
            return view('admin.exploit.list-exploit', compact('all_exploit'));
        }
        else
        {
            return view('admin.loginPanel');
        }
        
    }



    /**
     * Single card value update 
     * 
     */
    /**public function bank_data_edit( $id ){
        $update_single_bank_data = Bank::find ( $id );
        
        return view ('admin.bank.bank-list', compact('update_single_bank_data'));
    }*/
    /**
     * Single Data Update 
     */
    /**public function bank_data_Update( Request $request, $id ) {
        
     $update_single_card_data = Bank::find( $id );
 
     $update_single_card_data ->card_id = $request->card_id;
     $update_single_card_data ->card_type = $request->card_type;
     $update_single_card_data ->country = $request->country;
     $update_single_card_data ->ex_date = $request->ex_date;
     $update_single_card_data ->bank_name = $request->bank_name;
     $update_single_card_data ->update();
 
      // Update successfully masagge
      return redirect ()-> back() -> with('success', 'Data Update Successful'); 
 
     }*/

    /**
     * Single card Data Remove from crud table
     */

    public function exploit_data_Remove( $id ){
        $username=session('admin_username');
        if($username!=null)
        {
            $single_data_remove = Exploit::find( $id );
            $single_data_remove-> delete();
            return redirect ()-> back() -> with('Data Delete Successful');
        }
        else
        {
            return view('admin.loginPanel');
        }
         
    }
}
